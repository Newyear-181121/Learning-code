

<h1>
    <center>二. 应用层</center>
</h1>

 让运行在不同端系统上的应用程序能通过网络互相通讯、传输数据分组。

<a name="toc" href=""> </a>目录

[TOC]

## 2.1 应用层协议原理

### 2.1.1 网络应用程序体系结构

#### 1 客户-服务器体系结构

总有一台服务器，用来服务来自其他客户的请求。

例如 ： web ，FTP，Telnet ，电子邮件，

在此体系中，常常会出现一台服务器无法处理其他所有客户请求的情况，

为此，配备了大量主机的**数据中心**常用于创建强大的虚拟服务器。

#### 2 对等（P2P) 体系结构

此结构对数据中心的专用服务器有最小（或者没有）依赖。

应用程序在间断连接的主机之间使用直接通讯。

该机构最引人入胜的特性之一是**自扩展性**。



### 2.1.2 进程通讯

**进程**（process） 是实际上进行通讯的。

在不同端系统上的进程，通过跨越计算机网络交换**报文**而互相通信。

#### 1. 进程与计算机网络之间的接口

进程通过套接字向网络层发送或接收报文。

套接字是一台主机内应用层与运输层的之间的接口。

套接字是建立网络应用程序的可编程接口。因此套接字也称为 应用程序和网络之间的**应用程序编程接口**

#### 2. 进程寻址

1.  主机地址标识 用**ip地址**标识
2.  主机中指定的进程 用端口号标识。



### 2.1.3 可供应用程序使用的运输服务

具体选择哪种运输层协议，根据应用程序服务要求来选， 按此要求可以分为四个方面。

#### 1. 可靠的数据传输

确保应用程序的一端发送的数据正确、完全地交付给应用程序的另一端。

如果一个协议提供了这样的确保数据交付服务， 就认为提供了**可靠数据传输**

>   运输层协议能够潜在地向应用程序提供一个重要的服务是 进程到进程的可靠数据传输.
>
>   
>
>   当一个运输层协议不提供可靠数据传输是，由发送进程发出的某些数据可能到达不了接收进程。
>
>   这可能能被**容忍丢失的应用**所接受

#### 2. 吞吐量

可用吞吐量是 在沿着一条网络路径上的两个进程之间通信时 ，发送进程能够向接收进程交付的比特速率。

>   可用吞吐量会随时间波动，因为会有其他会话共享改网络路径的带宽，切这些会话随时可能会到达和离开。

运输层协议能够以某种特定的速率提供确保的可用吞吐量。

具有吞吐量要求的应用应用程序被称为**带宽敏感的应用**。

>   带宽敏感的应用就有特定吞吐量要求。
>
>   **弹性应用**

#### 3. 定时

运输层协议也能提供定时保证，

>   发送方注入进套接字中的每个比特到达接收方的套接字不迟于 100 ms

就是保证 传输总时延 在设定时间内。

>   保证较低的时延。

#### 4. 安全性

运输协议能够提供一种或多种安全性服务。

>   例如：在发送主机中，运输协议能够加密由发送进程传输的所有数据，在接收主机中，能把数据解密后交付给接收进程。

机密性、数据完整性和端点鉴别。

### 2.1.4 因特网提供的运输服务

因特网（一般是TCP/IP网络）为应用程序提供两个运输层协议 UDP 和 TCP

#### 1. TCP服务

TCP服务模型包括面向连接服务和可靠数据传输服务。

>   某个应用程序选择这个协议时，tcp就会提供这两种服务。

-   **面向连接的服务**：在应用层数据报文开始流动之前，TCP会在客户和服务器之间建立一个**TCP连接**，

>   这条连接是全双工的，即连接双方的进程可以在此连接上同时进行报文手发。

-   **可靠的数据传送服务**：通信进程能够依靠TCP，无差错，按适当顺序交付所有发送的数据。没有字节的丢失和冗余。

TCP协议还具有拥塞控制机制。

```
SSL安全套接字层  TCP的加强版，相比TCP还额外提供了关键的安全性服务。包括 加密，数据完整性和端点鉴别。
SSL是对TCP的加强，这种强化是在应用层实现的。
```



#### 2. UDP服务

UDP是一种不提供不必要服务的轻量级运输协议，它仅提供最小服务。

>   UDP是无连接的，
>
>   不可靠数据传送服务
>
>   没有拥塞控制机制

### 2.1.5 应用层协议

>   通过把报文发送进套接字实现网络进程间的相互通信。

**应用层协议**定义了运行在不同端系统上的应用程序进程如何相互传递报文。

定义了：

>   -   交换的报文类型，例如请求报文和响应报文。
>   -   各种报文类型的语法，如报文中的各个字段及这些字段是如何描述的。
>   -   字段的语义，即这些字段中的信息的含义。
>   -   确定一个进程何时以及如何发送报文。对报文进行响应的规则。

应用层协议只是网络应用的一部分。



<a href="#toc">返回目录</a>

---



## 2.2 WEB 和 HTTP



### 2.2.1 HTTP 概况

Web的应用层协议是**超文本传输协议**（HTTP)，它是web的核心。

HTTP由两个程序实现：一个客户端程序和一个服务器程序，运行在不同端系统，通过交换HTTP报文进行会话。

-   Web术语

>   **Web页面**是由对象组成的。
>
>   一个**对象**只是一个文件。
>
>   多数web页面含有一个**HTML基本文件**以及几个引用对象。

HTTP定义了Web客户向web服务器请求Web页面的方式，以及服务器响应后返回web页面的方式。

>   点击一个url时，在应用层浏览器发生了：
>
>   当用户请求一个Web页面（如点击一个超链接）时，浏览器向服务器发起一个TCP连接，通过套接字接口访问TCP发出对该页面中所包含对象的HTTP请求报文，服务器接收到请求并响应一个包含这些对象的HTTP报文。

**HTTP使用TCP作为它的支撑运输协议。**

HTTP是一个**无状态协议**，因为HTTP服务器并不保存关于客户的任何信息。



### 2.2.2 非持续连接和持续连接

**非持续连接**： 每个请求/响应对 是经一个单独的TCP连接发送，

**持续连接** ： 所有的请求及响应经相同的TCP连接发送。



#### 1.采用非持续连接的HTTP

**往返时间**（RTT）是指一个短分组从客户到服务器然后再返回客户所花费时间。

>   RTT包括分组传播时延、分组在中间路由器和交换机上的排队时延以及分组处理时延。

缺点：

>   1.  必须为每一个请求的对象建立和维护一个全新的连接。  对于每个这样的连接，在客户和服务器中都要分配TCP的缓冲区和保持TCP变量，这给服务器带来了严重的负担。
>   2.  每个对象经受两倍RTT的交付延时。  即一个RTT用于创建TCP，另一个RTT用于请求和接收一对象。



#### 2. 采用持续连接的HTTP

服务器在发送响应后保持该TCP链接打开。在相同的客户与服务器之间，后续的请求和响应报文能通过相同的连接进行传送。



### 2.2.3 HTTP 报文格式

#### 4. HTTP请求报文

>   第一行叫 **请求行**，其后继行叫**首部行**
>
>   请求行有三个字段：方法字段，URL字段，HTTP版本字段。
>
>   方法字段： 
>
>   >   GET ,POST,PUT,DELETE.
>
>   首部行：
>
>   >   
>
>   在首部行之后有一个"**实体体**"
>
>   >   使用get方法时 实体体为空
>   >
>   >   使用post方法时才有实体体.



#### 2. HTTP响应报文

有三个部分：

>   状态行
>
>   >   [常见的状态响应码](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status)
>
>   首部行
>
>   实体体  ： 是报文的主要部分，包含了所请求的对象本身。



### 2.2.4 用户与服务器的交互：cookie

HTTP服务器是无状态的。这简化了服务器的设计。

>   然而一个站点通常希望能够识别用户， 可能是因为服务器希望限制用户的访问，或者因为他希望吧内容与用户身份联系起来。
>
>   cookie 允许站点对用户进行跟踪。

cookie技术有4个组件：

>   1 在HTTP响应报文中的一个cookie首部行。
>
>   2 在HTTP请求报文中的一个cookie首部行。
>
>   3 在用户端启动中保留有一个cookie文件，并由用户的浏览器进行管理；
>
>   4 位于Web站点的一个后端数据库。



###  2.2.5 Web 缓存

Web缓存器 也叫代理服务器。



优点：

>   首先Web缓存器可以大大减少对客户请求的响应时间。
>
>   Web缓存器能够大大减少一个机构的计入链路到因特网的通信量。
>
>   Web缓存器能从整体上大大降低因特网上的Web流量，从而改善了所有的应用性能。

内容分发网络（CDN)



### 2.2.3 条件GET方法

HTTP协议有一种机制，允许缓存服务器证实他的对象是最新的，这种机制就是**条件GET**方法

>   如果请求报文使用GET方法，
>
>   并且请求报文中包含一个“If-Modified-Since:" 的首部行，
>
>   那么这个HTTP方法就是一个条件GET方法。

>   缓存器发送一个条件GET方法执行最新检查：
>
>   >   条件首部   带上副本最后的修改时间，
>   >
>   >   改条件GET报文告诉服务器，仅当自指定日期之后该对象被修改过，才发送改对象。
>   >
>   >   最后响应报文中状态为 304 Not Modified 表示：
>   >
>   >   >   告诉缓存器，这个对象从这个指定时间之后未发生更改，
>   >   >
>   >   >   缓存服务器可以使用这个对象。
>   >   >
>   >   >   能想请求的客户转发这个请求对象。

<a href="#toc">返回目录</a>

---



## 2.3 因特网中的电子邮件

电子邮件是一种异步通信媒介。

电子邮件系统的3个主要组成部分：

>   用户代理，
>
>   >   允许用户 阅读，回复，转发， 保存，和撰写报文。
>
>   邮件服务器，
>
>   >   每个接收方在其中的某个邮件服务器上有一个**邮箱**
>   >
>   >   
>
>   简单邮件传输协议

一个典型的邮件发送过程是：

>   从发送方的用户代理开始，传输到发送方的邮件服务器，再到接收方的邮件服务器，让后到接收方的邮箱。

### 2.3.2 与HTTP的对比

>   >    HTTP主要是一个**拉协议**
>   >
>   >   SMTP基本上是一个**推协议**
>
>   >   SMTP要求每个报文采用7比特ASCII码格式
>   >
>   >   HTTP没有。
>
>   >   HTTP把每个对象封装到它自己的HTTP响应报文中，
>   >
>   >   SMTP则把所有报文对象放在一个报文中。



<a href="#toc">返回目录</a>

---





## 2.4 DNS : 英特网的目录服务



### 2.4.1  DNS 提供的服务

主机名到 IP 地址转换的目录服务。这就是 **域名系统**的主要任务。

DNS是：

>   一个由分层的**DNS服务器**实现的分布式数据库；
>
>   一个使得主机能够查询分布式数据库的应用层协议。

DNS服务器通常是运行BIND软件的UNIX机器。

>   DNS 协议运行在UDP上，使用53端口。

**为应用服务，而不是直接为用户服务。**

其他的重要服务：

>   主机别名：
>
>   邮件服务器别名：
>
>   负载分配：

<a href="#toc">返回目录</a>

---

